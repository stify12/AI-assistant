<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>提示词优化 - AI 助手</title>
    <!-- 预加载关键资源 -->
    <link rel="preload" href="/static/css/common.css?v=20260124" as="style">
    <link rel="preload" href="/static/css/prompt-optimize.css?v=20260124" as="style">
    <link rel="preload" href="/static/js/prompt-optimize.js?v=20260124" as="script">
    <!-- 样式表 -->
    <link rel="stylesheet" href="/static/css/common.css?v=20260124">
    <link rel="stylesheet" href="/static/css/prompt-optimize.css?v=20260124">
    <!-- 第三方库延迟加载 -->
    <script src="https://cdn.bootcdn.net/ajax/libs/marked/9.1.6/marked.min.js" defer></script>
</head>
<body>
    <div class="app-container">
        <!-- 顶部导航 -->
        <header class="top-header">
            <div class="header-left">
                <button class="back-btn" onclick="goBack()" title="返回">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
                </button>
                <button class="menu-btn" onclick="toggleSidebar()">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
                </button>
                <div class="task-info">
                    <select id="taskSelect" class="task-select" onchange="loadTask()">
                        <option value="">选择任务...</option>
                    </select>
                    <select id="versionSelect" class="version-select" onchange="loadVersion()">
                        <option value="current">当前版本</option>
                    </select>
                </div>
            </div>
            <div class="header-center">
                <div class="tab-nav">
                    <button class="tab-btn" data-tab="debug" onclick="switchTab('debug')">调试</button>
                    <button class="tab-btn active" data-tab="batch" onclick="switchTab('batch')">批量</button>
                    <button class="tab-btn" data-tab="optimize" onclick="switchTab('optimize')">智能优化</button>
                </div>
            </div>
            <div class="header-right">
                <button class="btn-new-task" onclick="showNewTaskModal()">+ 新建任务</button>
            </div>
        </header>

        <!-- 主内容区 -->
        <div class="main-content">
            <!-- 左侧边栏 - Prompt 编辑器 -->
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <span>系统 Prompt/<span id="currentVersionLabel">V1</span></span>
                    <button class="btn-collapse" onclick="toggleSidebar()">«</button>
                </div>
                
                <!-- 任务场景和调优模式选择 -->
                <div class="task-config-section">
                    <div class="config-row-inline">
                        <label>任务场景:</label>
                        <select id="taskSceneSelect" class="config-select-small" onchange="onTaskSceneChange()">
                            <option value="single">单轮对话</option>
                            <option value="multi">多轮对话</option>
                            <option value="vision" selected>视觉理解</option>
                        </select>
                    </div>
                    <div class="config-row-inline">
                        <label>调优模式:</label>
                        <select id="evalModeSelect" class="config-select-small" onchange="onEvalModeChange()">
                            <option value="score" selected>评分模式</option>
                            <option value="gsb">GSB比较</option>
                        </select>
                    </div>
                </div>
                
                <div class="prompt-editor-wrapper">
                    <div class="prompt-label-row">
                        <span class="prompt-label" id="promptLabel">Prompt</span>
                        <button class="btn-ai-gen" onclick="generatePromptFromTask()" title="AI根据任务描述生成Prompt">
                            <svg viewBox="0 0 24 24" width="14" height="14"><path fill="currentColor" d="M19 9l-7 7-7-7"/></svg>
                            AI生成
                        </button>
                    </div>
                    <textarea id="promptEditor" class="prompt-textarea" placeholder="输入 Prompt，使用 {{变量名}} 定义变量..."></textarea>
                </div>
                <div class="sidebar-footer">
                    <div class="model-select-row">
                        <label>模型:</label>
                        <select id="modelSelect" class="model-select" onchange="onModelChange()">
                            <optgroup label="视觉识别">
                                <option value="doubao-1-5-vision-pro-32k-250115">Vision Pro</option>
                                <option value="doubao-seed-1-6-vision-250815">Seed Vision</option>
                                <option value="doubao-seed-1-6-251015">Seed 1.6</option>
                                <option value="doubao-seed-1-8-251215" selected>Seed 1.8</option>
                                <option value="doubao-seed-1-6-thinking-250715">Seed Thinking</option>
                                <option value="qwen-vl-plus">Qwen VL</option>
                            </optgroup>
                            <optgroup label="日常聊天">
                                <option value="gpt-5-chat-latest">GPT-5 Chat</option>
                                <option value="gpt-5.2">GPT-5.2</option>
                                <option value="gpt-5.1">GPT-5.1</option>
                                <option value="gpt-5-mini">GPT-5 Mini</option>
                                <option value="gpt-4.1">GPT-4.1</option>
                                <option value="grok-4">Grok-4</option>
                                <option value="gemini-3-pro-preview">Gemini 3 Pro</option>
                                <option value="gemini-3-flash-preview">Gemini 3 Flash</option>
                                <option value="gemini-3-flash-preview-nothinking">Gemini 3 Flash NoThink</option>
                                <option value="gemini-3-flash-preview-thinking">Gemini 3 Flash Think</option>
                                <option value="deepseek-v3.2">DeepSeek V3.2</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="prompt-actions">
                        <button class="btn-small" onclick="rewritePrompt()">一键改写</button>
                        <button class="btn-small primary" onclick="saveVersion()">保存版本</button>
                    </div>
                </div>
            </aside>

            <!-- 中间内容区 -->
            <main class="content-area">
                <!-- 调试模式 -->
                <section class="tab-content" id="debugContent">
                    <div class="debug-layout-new">
                        <!-- 左侧：Prompt调试区 -->
                        <div class="debug-left">
                            <div class="debug-prompt-section">
                                <div class="debug-prompt-header">
                                    <span class="debug-title">调试 Prompt</span>
                                    <span class="debug-version">V1</span>
                                    <div class="debug-actions">
                                        <button class="btn-debug-action" onclick="clearDebugVariables()">
                                            <svg viewBox="0 0 24 24" width="14" height="14"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                                        </button>
                                        <button class="btn-debug-action" onclick="fillVariables()">{ } 填写变量</button>
                                        <button class="btn-debug-primary" onclick="generateResponse()">
                                            <svg viewBox="0 0 24 24" width="14" height="14"><path fill="currentColor" d="M8 5v14l11-7z"/></svg>
                                            生成模型回答
                                        </button>
                                    </div>
                                </div>
                                <div class="debug-prompt-body">
                                    <textarea id="debugPromptArea" class="debug-prompt-textarea" placeholder="描述你的任务"></textarea>
                                    <!-- 图片上传区域 -->
                                    <div class="debug-image-upload" id="debugImageUpload">
                                        <input type="file" id="debugImageInput" accept="image/*" hidden onchange="handleDebugImageUpload(event)">
                                        <div class="debug-image-preview" id="debugImagePreview" style="display:none;">
                                            <img id="debugPreviewImg" src="">
                                            <button class="debug-image-remove" onclick="removeDebugImage()">×</button>
                                        </div>
                                        <button class="btn-upload-image" onclick="document.getElementById('debugImageInput').click()">
                                            <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
                                            上传图片
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 右侧：模型回答区 -->
                        <div class="debug-right">
                            <div class="debug-response-section">
                                <div class="debug-response-header">
                                    <span class="debug-title">模型回答</span>
                                    <div class="debug-model-info">
                                        <span class="model-badge" id="debugModelBadge">doubao-seed-1.6-251015</span>
                                        <button class="btn-copy" onclick="copyModelResponse()" title="复制">
                                            <svg viewBox="0 0 24 24" width="14" height="14"><path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                                        </button>
                                    </div>
                                </div>
                                <div class="debug-response-body" id="debugResponseBody">
                                    <div class="debug-response-placeholder">
                                        点击左侧「生成模型回答」后，大模型的回答将显示在这里
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 操作指引 -->
                            <div class="debug-guide-section">
                                <div class="debug-guide-header">
                                    <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19C8.14 2 5 5.14 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7z"/></svg>
                                    按以下步骤调试 Prompt:
                                </div>
                                <div class="debug-guide-steps">
                                    <div class="guide-step">
                                        <span class="step-num">1</span>
                                        <div class="step-content">
                                            <div class="step-title">填写 Prompt 并填充变量内容</div>
                                            <div class="step-desc">支持为大模型输入测试数据，从而生成特定的回答。可以输出格式化内容变量：{{USER_NAME}}</div>
                                        </div>
                                    </div>
                                    <div class="guide-step">
                                        <span class="step-num">2</span>
                                        <div class="step-content">
                                            <div class="step-title">生成模型回答</div>
                                            <div class="step-desc">可点击左侧「生成模型回答」获得大模型的回答，调试 Prompt 效果。</div>
                                        </div>
                                    </div>
                                    <div class="guide-step">
                                        <span class="step-num">3</span>
                                        <div class="step-content">
                                            <div class="step-title">添加至评测集</div>
                                            <div class="step-desc">将数据（模型回答、评分、理想回答）添加至评测集作为智能优化依据</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 评分和添加区域 -->
                            <div class="debug-scoring-section" id="debugScoringSection" style="display:none;">
                                <div class="debug-scoring-row">
                                    <div class="scoring-item">
                                        <label>理想回答 (可选):</label>
                                        <textarea id="debugIdealAnswer" class="debug-ideal-textarea" placeholder="输入理想回答..."></textarea>
                                        <button class="btn-ai-gen-small" onclick="generateIdealAnswer()">AI生成</button>
                                    </div>
                                </div>
                                <div class="debug-scoring-row">
                                    <div class="scoring-item">
                                        <label>评分 (可选，也可稍后使用AI智能评分):</label>
                                        <div class="debug-score-buttons" id="debugScoreButtons">
                                            <button class="score-btn" data-score="1" onclick="setScore(1)">1</button>
                                            <button class="score-btn" data-score="2" onclick="setScore(2)">2</button>
                                            <button class="score-btn" data-score="3" onclick="setScore(3)">3</button>
                                            <button class="score-btn" data-score="4" onclick="setScore(4)">4</button>
                                            <button class="score-btn" data-score="5" onclick="setScore(5)">5</button>
                                            <button class="score-btn" data-score="6" onclick="setScore(6)">6</button>
                                            <button class="score-btn" data-score="7" onclick="setScore(7)">7</button>
                                            <button class="score-btn" data-score="8" onclick="setScore(8)">8</button>
                                            <button class="score-btn" data-score="9" onclick="setScore(9)">9</button>
                                            <button class="score-btn" data-score="10" onclick="setScore(10)">10</button>
                                        </div>
                                    </div>
                                </div>
                                <button class="btn-add-to-dataset" onclick="addToDataset()">
                                    <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                                    添加至评测集
                                </button>
                                <div class="scoring-hint">提示：未评分的样本可在批量页面使用「智能评分」功能由AI自动评分</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 批量评测模式 -->
                <section class="tab-content active" id="batchContent">
                    <div class="batch-layout">
                        <!-- 工具栏 -->
                        <div class="batch-toolbar">
                            <div class="toolbar-title">评测数据集</div>
                            <div class="toolbar-actions">
                                <button class="btn-toolbar" onclick="addRow()">
                                    <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                                </button>
                                <button class="btn-toolbar" onclick="uploadFile()">
                                    <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M9 16h6v-6h4l-7-7-7 7h4v6zm-4 2h14v2H5v-2z"/></svg>
                                    上传文件
                                </button>
                                <input type="file" id="batchFileInput" accept=".xlsx,.csv" hidden onchange="handleFileUpload(event)">
                                <button class="btn-toolbar" onclick="showScoringPanel()">
                                    <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                                    智能评分
                                </button>
                                <button class="btn-toolbar primary" onclick="generateAllResponses()">
                                    <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M8 5v14l11-7z"/></svg>
                                    生成全部回答
                                </button>
                            </div>
                        </div>

                        <!-- 配置行 -->
                        <div class="config-row">
                            <div class="config-item">
                                <span class="config-label">评估模式:</span>
                                <span class="eval-mode-badge" id="evalModeBadge">评分模式 (1-5分)</span>
                            </div>
                            <div class="config-item">
                                <span class="config-label">评分标准:</span>
                                <span class="config-value" id="scoringCriteriaPreview">总分5分，基于以下维度评估：准确性、完整性...</span>
                            </div>
                        </div>

                        <!-- 数据表格 -->
                        <div class="data-table-wrapper">
                            <table class="data-table" id="dataTable">
                                <thead>
                                    <tr>
                                        <th class="col-checkbox"><input type="checkbox" id="selectAll" onchange="toggleSelectAll()"></th>
                                        <th class="col-index">#</th>
                                        <th class="col-input" id="colInputHeader">提问</th>
                                        <th class="col-response">模型回答</th>
                                        <th class="col-reference" id="colReferenceHeader">理想回答</th>
                                        <th class="col-score" id="colScoreHeader">评分</th>
                                        <th class="col-actions">操作</th>
                                    </tr>
                                </thead>
                                <tbody id="dataTableBody">
                                    <tr class="empty-row">
                                        <td colspan="7">
                                            <div class="empty-hint">暂无数据，点击"+"添加行或"上传文件"导入数据</div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- 分页 -->
                        <div class="pagination">
                            <button class="btn-add-row" onclick="addRow()">+ 添加行</button>
                            <div class="page-info">
                                共 <span id="totalItems">0</span> 项
                            </div>
                            <div class="page-controls">
                                <button class="page-btn" onclick="goToPage('prev')" id="prevBtn" disabled>‹</button>
                                <span class="page-numbers" id="pageNumbers">1</span>
                                <button class="page-btn" onclick="goToPage('next')" id="nextBtn" disabled>›</button>
                            </div>
                            <select class="page-size" id="pageSize" onchange="changePageSize()">
                                <option value="10">10 条/页</option>
                                <option value="20" selected>20 条/页</option>
                                <option value="50">50 条/页</option>
                            </select>
                        </div>
                    </div>
                </section>

                <!-- 智能优化模式 -->
                <section class="tab-content" id="optimizeContent">
                    <div class="optimize-layout">
                        <div class="optimize-check" id="optimizeCheck">
                            <div class="check-icon">
                                <svg viewBox="0 0 24 24" width="48" height="48"><path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                            </div>
                            <div class="check-title">智能优化前置检查</div>
                            <div class="check-status" id="checkStatus">检查中...</div>
                            <div class="check-requirements">
                                <div class="requirement-item" id="reqSamples">
                                    <span class="req-icon">○</span>
                                    <span>至少 5 个已评分样本</span>
                                </div>
                                <div class="requirement-item" id="reqPrompt">
                                    <span class="req-icon">○</span>
                                    <span>Prompt 已配置</span>
                                </div>
                            </div>
                            <button class="btn-start-optimize" id="startOptimizeBtn" onclick="startOptimization()" disabled>
                                开始智能优化
                            </button>
                        </div>
                    </div>
                </section>
            </main>

            <!-- 右侧评分面板 -->
            <aside class="scoring-sidebar" id="scoringSidebar">
                <div class="scoring-sidebar-header">
                    <div class="scoring-title">
                        <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                        智能评分
                    </div>
                    <button class="btn-close" onclick="hideScoringPanel()">×</button>
                </div>
                <div class="scoring-sidebar-body">
                    <p class="scoring-desc">基于你的规则或原型案例的评分标准，用于 AI 智能评分。<a href="#" class="link">使用手册</a></p>
                    
                    <div class="scoring-actions-row">
                        <button class="btn-score-action" onclick="scoreUnscored()">为未评分的回答评分</button>
                        <button class="btn-score-action secondary" onclick="scoreAll()">为所有回答评分</button>
                    </div>

                    <div class="scoring-rules-section">
                        <div class="rules-header">
                            <span>评分标准</span>
                            <button class="btn-ai-generate" onclick="generateScoringRules()">
                                <svg viewBox="0 0 24 24" width="14" height="14"><path fill="currentColor" d="M19 9l-7 7-7-7"/></svg>
                                AI生成
                            </button>
                        </div>
                        <textarea id="scoringRules" class="scoring-rules-textarea" rows="15" placeholder="总分5分，基于以下维度评估：

### 评估维度及扣分规则
1. **格式合规性（权重最高）**：
   - 若模型回答不是包含正确JSON数组的 `json代码块（如存在额外文字、格式错误、字段缺失），直接扣3分。

2. **完整性（权重次之）**：
   - 若缺漏STANDARD_ANSWERS中的任意题号，每遗漏1个扣1分。

3. **提取准确性（权重第三）**：
   - 若模型的userAnswer存在加工（如补全、改写、添加解释）或未完全提取原文字符串，每处扣0.5分。
   - 若userAnswer与图片手写内容不符（如识别错误），酌情扣1分。

### 得分对应规则
- 5分：格式完全合规，无遗漏，顺序正确，所有userAnswer精确提取无加工；
- 4分：格式合规，无遗漏，顺序正确，仅存在1处提取准确性问题；
- 3分：格式合规，无遗漏，顺序上错，存在2处提取问题（无提取或错误）；
- 2分：格式合规，但存在2处及以上完整性问题；或格式合规但存在较多提取问题；
- 1分：存在较大问题（如JSON格式有误但仍有部分小问题）；
- 0分：完全不符合要求。"></textarea>
                    </div>

                    <div class="scoring-method-section">
                        <div class="method-label">评分规则生成方式</div>
                        <div class="method-options">
                            <label class="method-option">
                                <input type="radio" name="scoringMethod" value="user" checked>
                                <span>用户输入评分标准</span>
                            </label>
                            <label class="method-option">
                                <input type="radio" name="scoringMethod" value="prompt">
                                <span>AI根据Prompt生成</span>
                            </label>
                            <label class="method-option">
                                <input type="radio" name="scoringMethod" value="learn">
                                <span>AI根据用户打分学习</span>
                            </label>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- 新建任务弹窗 -->
    <div class="modal" id="newTaskModal">
        <div class="modal-content">
            <h3>新建优化任务</h3>
            <div class="form-group">
                <label>任务名称</label>
                <input type="text" id="newTaskName" placeholder="例如：学生答案图片内容提取">
            </div>
            <div class="modal-actions">
                <button class="btn-cancel" onclick="hideNewTaskModal()">取消</button>
                <button class="btn-save" onclick="createTask()">创建</button>
            </div>
        </div>
    </div>

    <!-- 单元格详情弹窗 -->
    <div class="modal" id="cellModal">
        <div class="modal-content cell-modal">
            <div class="modal-header">
                <h3 id="cellModalTitle">查看内容</h3>
                <button class="modal-close" onclick="hideCellModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="cell-content" id="cellContent"></div>
            </div>
        </div>
    </div>

    <!-- 图片预览弹窗 -->
    <div class="image-modal" id="imageModal" onclick="hideImageModal()">
        <img id="modalImg" src="">
    </div>

    <!-- Prompt生成弹窗 -->
    <div class="modal" id="promptGenModal">
        <div class="modal-content prompt-gen-modal">
            <div class="modal-header">
                <h3>AI生成Prompt</h3>
                <button class="modal-close" onclick="hidePromptGenModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>任务描述</label>
                    <textarea id="taskDescInput" class="task-desc-textarea" placeholder="描述你的任务需求，例如：识别学生手写答案图片中的内容，提取每道题的答案并以JSON格式输出"></textarea>
                </div>
                <div class="form-group">
                    <label>快速选项</label>
                    <div class="gen-options">
                        <span class="gen-option" onclick="selectGenOption(this, '图片内容识别')">图片内容识别</span>
                        <span class="gen-option" onclick="selectGenOption(this, '文本分类')">文本分类</span>
                        <span class="gen-option" onclick="selectGenOption(this, '信息提取')">信息提取</span>
                        <span class="gen-option" onclick="selectGenOption(this, '问答对话')">问答对话</span>
                        <span class="gen-option" onclick="selectGenOption(this, '内容生成')">内容生成</span>
                    </div>
                </div>
                <div class="form-group" id="generatedPromptSection" style="display:none;">
                    <label>生成的Prompt</label>
                    <div class="generated-prompt-preview" id="generatedPromptPreview"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="hidePromptGenModal()">取消</button>
                <button class="btn-save" id="genPromptBtn" onclick="doGeneratePrompt()">生成Prompt</button>
                <button class="btn-save primary" id="applyPromptBtn" onclick="applyGeneratedPrompt()" style="display:none;">应用</button>
            </div>
        </div>
    </div>

    <!-- 行编辑弹窗 -->
    <div class="modal" id="rowEditModal">
        <div class="modal-content row-edit-modal">
            <div class="modal-header">
                <h3>编辑样本</h3>
                <button class="modal-close" onclick="hideRowEditModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="edit-section">
                    <label>图片/变量</label>
                    <div class="image-upload-area" id="editImageArea">
                        <input type="file" id="editImageInput" accept="image/*" hidden onchange="handleEditImageUpload(event)">
                        <div class="upload-placeholder" onclick="document.getElementById('editImageInput').click()">
                            点击上传图片
                        </div>
                        <img id="editImagePreview" class="image-preview" style="display:none;">
                    </div>
                </div>
                <div class="edit-section">
                    <label>理想回答</label>
                    <textarea id="editIdealAnswer" rows="6" placeholder="输入理想回答..."></textarea>
                </div>
                <div class="edit-section">
                    <label>模型回答</label>
                    <div class="model-response-display" id="editModelResponse">-</div>
                </div>
                <div class="edit-section" id="editScoreSection">
                    <label>评分 (1-10分)</label>
                    <div class="edit-score-buttons" id="editScoreButtons">
                        <button class="score-btn" data-score="1">1</button>
                        <button class="score-btn" data-score="2">2</button>
                        <button class="score-btn" data-score="3">3</button>
                        <button class="score-btn" data-score="4">4</button>
                        <button class="score-btn" data-score="5">5</button>
                        <button class="score-btn" data-score="6">6</button>
                        <button class="score-btn" data-score="7">7</button>
                        <button class="score-btn" data-score="8">8</button>
                        <button class="score-btn" data-score="9">9</button>
                        <button class="score-btn" data-score="10">10</button>
                    </div>
                </div>
                <div class="edit-section" id="editGSBSection" style="display:none;">
                    <label>GSB评估</label>
                    <div class="edit-gsb-buttons" id="editGSBButtons">
                        <button class="gsb-btn good" data-gsb="G">Good</button>
                        <button class="gsb-btn same" data-gsb="S">Same</button>
                        <button class="gsb-btn bad" data-gsb="B">Bad</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="hideRowEditModal()">取消</button>
                <button class="btn-save" onclick="saveRowEdit()">保存</button>
            </div>
        </div>
    </div>

    <script src="/static/js/prompt-optimize.js"></script>
</body>
</html>
