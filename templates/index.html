<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试计划看板 - AI效果分析平台</title>
    <!-- DNS 预解析 -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <!-- 关键CSS预加载 -->
    <link rel="preload" href="/static/css/common.css?v=20260124" as="style">
    <link rel="preload" href="/static/css/index.css?v=20260124" as="style">
    <!-- 关键JS预加载 -->
    <link rel="preload" href="/static/js/index.js?v=20260124" as="script">
    <!-- 样式表 -->
    <link rel="stylesheet" href="/static/css/common.css?v=20260124">
    <link rel="stylesheet" href="/static/css/index.css?v=20260124">
    <link rel="stylesheet" href="/static/css/dataset-optimize.css?v=20260125">
    <!-- 首屏关键CSS内联 -->
    <style>
        /* 骨架屏样式 - 避免布局抖动 */
        .stat-card-skeleton{display:flex;flex-direction:column;gap:8px;padding:16px}
        .skeleton-value,.skeleton-label,.skeleton-detail{background:linear-gradient(90deg,#2a2a2a 25%,#333 50%,#2a2a2a 75%);background-size:200% 100%;animation:shimmer 1.5s infinite;border-radius:4px}
        .skeleton-value{height:32px;width:60%}
        .skeleton-label{height:14px;width:80%}
        .skeleton-detail{height:12px;width:50%}
        @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
    </style>
</head>
<body>
    <!-- 左侧边栏导航 - 悬停展开效果 -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-welcome">
            <div class="sidebar-brand">
                <div class="brand-icon">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                </div>
                <span class="brand-text">AI 效果分析</span>
            </div>
            
            <div class="nav-section">
                <div class="nav-label">核心功能</div>
                <a href="/subject-grading" class="nav-card featured">
                    <div class="nav-card-icon">
                        <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>
                    </div>
                    <div class="nav-card-body">
                        <div class="nav-card-title">学科批改评估</div>
                        <div class="nav-card-desc">多学科作业批改效果分析</div>
                    </div>
                </a>
                <a href="/batch-evaluation" class="nav-card">
                    <div class="nav-card-icon">
                        <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14l-5-5 1.41-1.41L12 14.17l4.59-4.58L18 11l-6 6z"/></svg>
                    </div>
                    <div class="nav-card-body">
                        <div class="nav-card-title">批量评估</div>
                        <div class="nav-card-desc">批量对比AI批改结果</div>
                    </div>
                </a>
            </div>
            
            <div class="nav-section">
                <div class="nav-label">工具</div>
                <div class="nav-tools-compact">
                    <a href="/knowledge-agent" class="nav-tool-item" title="知识点类题">
                        <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M12 3L1 9l4 2.18v6L12 21l7-3.82v-6l2-1.09V17h2V9L12 3z"/></svg>
                        <span>知识点类题</span>
                    </a>
                    <a href="/data-analysis" class="nav-tool-item" title="数据分析">
                        <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg>
                        <span>数据分析</span>
                    </a>
                    <a href="/prompt-optimize" class="nav-tool-item" title="提示词优化">
                        <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65z"/></svg>
                        <span>提示词优化</span>
                    </a>
                    <a href="/dataset-manage" class="nav-tool-item" title="数据集管理">
                        <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2z"/></svg>
                        <span>数据集管理</span>
                    </a>
                </div>
            </div>
            
            <!-- 优化日志区域 -->
            <div class="nav-section opt-logs-section">
                <div class="nav-label">
                    <span>优化日志</span>
                    <button class="add-log-btn" onclick="showAddOptLogModal()" title="添加日志">+</button>
                </div>
                <div class="opt-logs-list" id="optLogsList">
                    <div class="opt-logs-empty">暂无日志</div>
                </div>
            </div>
            
            <div class="sidebar-footer">
                <button class="footer-btn" onclick="navigateTo('/chat')">
                    <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg>
                    <span>对话</span>
                </button>
                <button class="footer-btn" onclick="openGlobalSettingsModal()">
                    <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65z"/></svg>
                    <span>设置</span>
                </button>
            </div>
        </div>
    </aside>

    <!-- 主内容区 -->
    <main class="main-content">
        <!-- 顶部栏 (US-1.4, US-9) -->
        <header class="top-bar">
            <button class="menu-btn" id="menuBtn" onclick="toggleSidebar()">
                <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
            </button>
            <div class="sync-info">
                <span class="sync-label">最后同步:</span>
                <span class="sync-time" id="lastSyncTime">--</span>
            </div>
            <button class="refresh-btn" id="refreshBtn" onclick="refreshDashboard()">
                <svg class="refresh-icon" viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
                <span>刷新</span>
            </button>
            <div class="search-box">
                <svg class="search-icon" viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                <input type="text" id="searchInput" placeholder="搜索任务、数据集..." autocomplete="off">
                <div class="search-results" id="searchResults" style="display:none;"></div>
            </div>
        </header>

        <!-- 统计概览区 (US-2) -->
        <section class="stats-section">
            <!-- 1. 整体错误率（原准确率位置移到第一位） -->
            <div class="stat-card stat-card-error" id="errorRateCard">
                <div class="stat-card-skeleton" id="errorRateSkeleton">
                    <div class="skeleton-value"></div>
                    <div class="skeleton-label"></div>
                    <div class="skeleton-detail"></div>
                </div>
                <div class="stat-card-content" id="errorRateContent" style="display:none;">
                    <div class="stat-value">
                        <span id="errorRateValue">--</span>
                        <span class="trend-arrow" id="errorRateTrend"></span>
                    </div>
                    <div class="stat-label">整体错误率</div>
                    <div class="stat-detail" id="errorRateCompare">与昨日对比 --</div>
                    <div class="stat-source" id="errorRateSource" title="数据来源：批量评估任务中已完成评估的作业"></div>
                </div>
            </div>
            <!-- 2. 批量任务 -->
            <div class="stat-card" id="taskCard" onclick="navigateTo('/batch-evaluation')">
                <div class="stat-card-skeleton" id="taskSkeleton">
                    <div class="skeleton-value"></div>
                    <div class="skeleton-label"></div>
                    <div class="skeleton-detail"></div>
                </div>
                <div class="stat-card-content" id="taskContent" style="display:none;">
                    <div class="stat-value" id="taskTotal">0</div>
                    <div class="stat-label">批量任务</div>
                    <div class="stat-detail" id="taskByTime">
                        <span class="time-filter active" data-range="today" onclick="event.stopPropagation();switchTaskRange('today')">今日</span>
                        <span class="time-filter" data-range="week" onclick="event.stopPropagation();switchTaskRange('week')">本周</span>
                        <span class="time-filter" data-range="month" onclick="event.stopPropagation();switchTaskRange('month')">本月</span>
                    </div>
                </div>
            </div>
            <!-- 3. 题目总数 -->
            <div class="stat-card" id="questionCard">
                <div class="stat-card-skeleton" id="questionSkeleton">
                    <div class="skeleton-value"></div>
                    <div class="skeleton-label"></div>
                    <div class="skeleton-detail"></div>
                </div>
                <div class="stat-card-content" id="questionContent" style="display:none;">
                    <div class="stat-value" id="questionTotal">0</div>
                    <div class="stat-label">题目总数</div>
                    <div class="stat-detail" id="questionDetail">已测试 0 / 总计 0</div>
                </div>
            </div>
            <!-- 4. 数据集总数（移到最后，优化显示） -->
            <div class="stat-card" id="datasetCard" onclick="navigateTo('/dataset-manage')">
                <div class="stat-card-skeleton" id="datasetSkeleton">
                    <div class="skeleton-value"></div>
                    <div class="skeleton-label"></div>
                    <div class="skeleton-detail"></div>
                </div>
                <div class="stat-card-content" id="datasetContent" style="display:none;">
                    <div class="stat-value" id="datasetTotal">0</div>
                    <div class="stat-label">数据集总数</div>
                    <div class="stat-detail" id="datasetBySubject">--</div>
                    <div class="stat-source" id="datasetWeekNew"></div>
                </div>
            </div>
        </section>

        <!-- 主体内容区：第一行 - 测试计划(70%) + 高级工具(30%) -->
        <div class="dashboard-row-1">
            <!-- 左侧：测试计划流程图区 -->
            <section class="plan-section">
                <div class="section-header">
                    <h2 class="section-title">今日测试计划</h2>
                    <div class="plan-controls">
                        <select class="plan-filter" id="planStatusFilter" onchange="filterPlans()">
                            <option value="all">全部状态</option>
                            <option value="draft">草稿</option>
                            <option value="active">进行中</option>
                            <option value="completed">已完成</option>
                            <option value="archived">已归档</option>
                        </select>
                        <button class="btn btn-primary" onclick="openCreatePlanModal()">
                            <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                            <span>新建计划</span>
                        </button>
                    </div>
                </div>
                <div class="plan-list" id="planList">
                    <!-- 骨架屏 -->
                    <div class="plan-skeleton" id="planListSkeleton">
                        <div class="plan-card-skeleton"></div>
                        <div class="plan-card-skeleton"></div>
                    </div>
                    <!-- 测试计划列表内容 -->
                    <div class="plan-list-content" id="planListContent" style="display:none;"></div>
                </div>
            </section>

            <!-- 右侧：高级分析工具 -->
            <section class="advanced-tools-section" id="advancedToolsSection">
                <div class="section-header">
                    <h2 class="section-title">高级分析</h2>
                </div>
                <div class="tools-grid-vertical">
                    <!-- 错误样本库 -->
                    <div class="tool-card" onclick="openErrorSamplesModal()">
                        <div class="tool-card-icon">
                            <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm-1 9h-2v2H9v-2H7v-2h2V7h2v2h2v2zm-1-7.5V9h4.5L12 3.5z"/></svg>
                        </div>
                        <div class="tool-card-content">
                            <div class="tool-card-name">错误样本</div>
                            <div class="tool-card-desc">查看批改错误案例</div>
                        </div>
                        <div class="tool-card-badge" id="errorSampleCount">0</div>
                    </div>
                    
                    <!-- 异常检测 -->
                    <div class="tool-card" onclick="openAnomalyModal()">
                        <div class="tool-card-icon warning">
                            <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                        </div>
                        <div class="tool-card-content">
                            <div class="tool-card-name">异常检测</div>
                            <div class="tool-card-desc">发现异常评分模式</div>
                        </div>
                        <div class="tool-card-badge warning" id="anomalyCount">0</div>
                    </div>
                    
                    <!-- 错误聚类 -->
                    <div class="tool-card" onclick="openClusteringModal()">
                        <div class="tool-card-icon">
                            <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/><circle cx="8" cy="12" r="2" fill="currentColor"/><circle cx="12" cy="12" r="2" fill="currentColor"/><circle cx="16" cy="12" r="2" fill="currentColor"/></svg>
                        </div>
                        <div class="tool-card-content">
                            <div class="tool-card-name">错误聚类</div>
                            <div class="tool-card-desc">按类型归类错误</div>
                        </div>
                        <div class="tool-card-badge" id="clusterCount">0</div>
                    </div>
                    
                    <!-- 优化建议 -->
                    <div class="tool-card" onclick="openOptimizationModal()">
                        <div class="tool-card-icon">
                            <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19C8.14 2 5 5.14 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7zm2.85 11.1l-.85.6V16h-4v-2.3l-.85-.6A4.997 4.997 0 017 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 1.63-.8 3.16-2.15 4.1z"/></svg>
                        </div>
                        <div class="tool-card-content">
                            <div class="tool-card-name">优化建议</div>
                            <div class="tool-card-desc">AI改进建议</div>
                        </div>
                        <div class="tool-card-badge" id="suggestionCount">0</div>
                    </div>
                    
                    <!-- 批次对比 -->
                    <div class="tool-card" onclick="openBatchCompareModal()">
                        <div class="tool-card-icon">
                            <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M10 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h5v2h2V1h-2v2zm0 15H5l5-6v6zm9-15h-5v2h5v13l-5-6v9h5c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/></svg>
                        </div>
                        <div class="tool-card-content">
                            <div class="tool-card-name">批次对比</div>
                            <div class="tool-card-desc">对比不同批次结果</div>
                        </div>
                    </div>
                    
                    <!-- 数据下钻 -->
                    <div class="tool-card" onclick="openDrilldownModal()">
                        <div class="tool-card-icon">
                            <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg>
                        </div>
                        <div class="tool-card-content">
                            <div class="tool-card-name">数据下钻</div>
                            <div class="tool-card-desc">深入分析数据</div>
                        </div>
                    </div>
                    
                    <!-- 自动化管理 -->
                    <div class="tool-card" onclick="openAutomationModal()">
                        <div class="tool-card-icon">
                            <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
                        </div>
                        <div class="tool-card-content">
                            <div class="tool-card-name">自动化管理</div>
                            <div class="tool-card-desc">管理自动化任务</div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- 第二行：学科评估分析(60%) + 数据集概览(40%) -->
        <div class="dashboard-row-2">
            <!-- 左侧：学科评估分析（原热点图位置） -->
            <section class="subject-analysis-section-main" id="subjectAnalysisSection">
                <div class="section-header">
                    <h2 class="section-title">学科评估分析</h2>
                    <div class="subject-controls">
                        <button class="btn btn-text" onclick="exportSubjectReport()">
                            <svg viewBox="0 0 24 24" width="14" height="14"><path fill="currentColor" d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
                            导出
                        </button>
                    </div>
                </div>
                
                <div class="subject-skeleton" id="subjectSkeleton">
                    <div class="skeleton-chart"></div>
                </div>
                
                <div class="subject-content" id="subjectContent" style="display:none;">
                    <!-- 学科统计摘要 -->
                    <div class="subject-summary">
                        <div class="subject-summary-item">
                            <span class="subject-summary-value" id="subjectTotalCount">0</span>
                            <span class="subject-summary-label">学科数</span>
                        </div>
                        <div class="subject-summary-item">
                            <span class="subject-summary-value" id="subjectTaskCount">0</span>
                            <span class="subject-summary-label">总任务</span>
                        </div>
                        <div class="subject-summary-item">
                            <span class="subject-summary-value" id="subjectQuestionCount">0</span>
                            <span class="subject-summary-label">总题目</span>
                        </div>
                        <div class="subject-summary-item">
                            <span class="subject-summary-value" id="subjectAvgAccuracy">--</span>
                            <span class="subject-summary-label">平均准确率</span>
                        </div>
                    </div>
                    
                    <!-- 学科准确率列表 -->
                    <div class="subject-list-main" id="subjectList"></div>
                </div>
            </section>

            <!-- 右侧：数据集概览 -->
            <div class="right-panel">
                <!-- 数据集统计概览 -->
                <section class="dataset-stats-section">
                    <div class="section-header">
                        <h2 class="section-title">数据集概览</h2>
                        <button class="btn btn-ai" onclick="openAIPlanModal()" title="AI生成测试计划">
                            <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M19 9l1.25-2.75L23 5l-2.75-1.25L19 1l-1.25 2.75L15 5l2.75 1.25L19 9zm-7.5.5L9 4 6.5 9.5 1 12l5.5 2.5L9 20l2.5-5.5L17 12l-5.5-2.5z"/></svg>
                            <span>AI生成计划</span>
                        </button>
                    </div>
                    
                    <!-- 统计卡片 -->
                    <div class="dataset-stats-grid">
                        <div class="mini-stat-card">
                            <div class="mini-stat-value" id="datasetTotalValue">0</div>
                            <div class="mini-stat-label">数据集数</div>
                        </div>
                        <div class="mini-stat-card">
                            <div class="mini-stat-value" id="datasetQuestionValue">0</div>
                            <div class="mini-stat-label">总题目数</div>
                        </div>
                        <div class="mini-stat-card">
                            <div class="mini-stat-value" id="datasetAccuracyValue">--</div>
                            <div class="mini-stat-label">平均准确率</div>
                        </div>
                        <div class="mini-stat-card">
                            <div class="mini-stat-value" id="datasetUsageValue">0</div>
                            <div class="mini-stat-label">本周使用</div>
                        </div>
                    </div>
                    
                    <!-- 图表区 - 学科分布饼图 -->
                    <div class="dataset-chart-area">
                        <div class="pie-chart-wrapper">
                            <canvas id="datasetPieChart" width="180" height="180"></canvas>
                        </div>
                        <div class="pie-legend-wrapper" id="datasetPieLegend"></div>
                    </div>
                </section>
            </div>
        </div>

        <!-- 第三行：日报 + 趋势 -->
        <div class="dashboard-row-3">
        <!-- 日报区 (US-14) -->
        <section class="reports-section" id="reportsSection">
            <div class="section-header">
                <h2 class="section-title">测试日报</h2>
                <div class="reports-controls">
                    <button class="btn btn-primary" onclick="generateDailyReport()">
                        <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>
                        <span>生成今日日报</span>
                    </button>
                </div>
            </div>
            
            <!-- 日报列表 -->
            <div class="reports-list" id="reportsList">
                <div class="reports-skeleton" id="reportsListSkeleton">
                    <div class="report-item-skeleton"></div>
                    <div class="report-item-skeleton"></div>
                    <div class="report-item-skeleton"></div>
                </div>
                <div class="reports-list-content" id="reportsListContent" style="display:none;"></div>
            </div>
            
            <!-- 分页 -->
            <div class="reports-pagination" id="reportsPagination" style="display:none;">
                <button class="pagination-btn" id="reportsPrevBtn" onclick="loadReportsPage('prev')" disabled>上一页</button>
                <span class="pagination-info" id="reportsPaginationInfo">1 / 1</span>
                <button class="pagination-btn" id="reportsNextBtn" onclick="loadReportsPage('next')" disabled>下一页</button>
            </div>
        </section>

        <!-- 趋势分析区 (US-15) -->
        <section class="trends-section" id="trendsSection">
            <div class="section-header">
                <h2 class="section-title">趋势分析</h2>
                <div class="trends-controls">
                    <select id="trendsDaysFilter" class="form-select" onchange="filterTrends()">
                        <option value="7">近7天</option>
                        <option value="30">近30天</option>
                        <option value="90">近90天</option>
                    </select>
                    <select id="trendsSubjectFilter" class="form-select" onchange="filterTrends()">
                        <option value="">全部学科</option>
                        <option value="0">英语</option>
                        <option value="1">语文</option>
                        <option value="2">数学</option>
                        <option value="3">物理</option>
                        <option value="4">化学</option>
                        <option value="5">生物</option>
                        <option value="6">地理</option>
                    </select>
                    <button class="btn btn-secondary" onclick="exportTrends()">
                        <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
                        <span>导出CSV</span>
                    </button>
                </div>
            </div>
            
            <!-- 趋势图 -->
            <div class="trends-chart-container">
                <div class="trends-skeleton" id="trendsSkeleton">
                    <div class="skeleton-line"></div>
                    <div class="skeleton-line"></div>
                    <div class="skeleton-line"></div>
                </div>
                <div class="trends-content" id="trendsContent" style="display:none;">
                    <canvas id="trendsCanvas" width="800" height="300"></canvas>
                </div>
            </div>
        </section>
        </div>
    </main>

    <!-- 创建测试计划弹窗 (增强版 - 支持工作流配置) -->
    <div class="modal" id="createPlanModal" onclick="onCreatePlanModalBackdropClick(event)" style="display:none;">
        <div class="modal-content create-plan-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">新建测试计划</h3>
                <button class="modal-close" onclick="closeCreatePlanModal()">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            
            <div class="modal-body">
                <!-- 基本信息 -->
                <div class="form-section">
                    <div class="form-section-title">基本信息</div>
                    
                    <div class="form-group">
                        <label class="form-label" for="createPlanName">计划名称 <span class="required">*</span></label>
                        <input type="text" id="createPlanName" class="form-input" placeholder="如：物理温度章节测试">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="createPlanDescription">计划描述</label>
                        <textarea id="createPlanDescription" class="form-textarea" rows="2" placeholder="描述测试目标和范围"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="createPlanSubject">目标学科</label>
                            <select id="createPlanSubject" class="form-select">
                                <option value="">请选择学科</option>
                                <option value="0">英语</option>
                                <option value="1">语文</option>
                                <option value="2">数学</option>
                                <option value="3">物理</option>
                                <option value="4">化学</option>
                                <option value="5">生物</option>
                                <option value="6">地理</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="createPlanTarget">目标测试量</label>
                            <input type="number" id="createPlanTarget" class="form-input" value="30" min="1" max="100">
                        </div>
                    </div>
                </div>
                
                <!-- 作业匹配配置 -->
                <div class="form-section">
                    <div class="form-section-title">作业匹配配置</div>
                    
                    <div class="form-group">
                        <label class="form-label" for="createPlanKeyword">任务关键字 <span class="required">*</span></label>
                        <div class="input-with-button">
                            <input type="text" id="createPlanKeyword" class="form-input" placeholder="如：p97-98、物理八上第三章">
                            <button type="button" class="btn btn-secondary btn-sm" onclick="previewKeywordMatch()" id="previewMatchBtn">
                                <svg viewBox="0 0 24 24" width="14" height="14"><path fill="currentColor" d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                                预览匹配
                            </button>
                        </div>
                        <span class="form-hint">输入作业发布任务的关键字，用于匹配 zpsmart 系统中的作业</span>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="createPlanMatchType">匹配方式</label>
                        <select id="createPlanMatchType" class="form-select">
                            <option value="fuzzy">模糊匹配（推荐）</option>
                            <option value="exact">精确匹配</option>
                            <option value="regex">正则表达式</option>
                        </select>
                        <span class="form-hint">模糊匹配：包含关键字即可；精确匹配：完全相同；正则：支持正则表达式</span>
                    </div>
                    
                    <!-- 匹配预览结果区域 -->
                    <div class="match-preview-container" id="matchPreviewContainer" style="display:none;">
                        <div class="match-preview-header">
                            <span class="match-preview-title">匹配预览结果</span>
                            <span class="match-preview-count" id="matchPreviewCount">0 条匹配</span>
                        </div>
                        <div class="match-preview-stats" id="matchPreviewStats">
                            <div class="match-stat-item">
                                <span class="match-stat-value" id="matchTotalHomework">0</span>
                                <span class="match-stat-label">总作业数</span>
                            </div>
                            <div class="match-stat-item">
                                <span class="match-stat-value" id="matchTotalGraded">0</span>
                                <span class="match-stat-label">已批改</span>
                            </div>
                            <div class="match-stat-item">
                                <span class="match-stat-value" id="matchGradingProgress">0%</span>
                                <span class="match-stat-label">批改进度</span>
                            </div>
                        </div>
                        <div class="match-preview-list" id="matchPreviewList">
                            <!-- 动态渲染匹配结果 -->
                        </div>
                    </div>
                </div>
                
                <!-- 数据集配置 -->
                <div class="form-section">
                    <div class="form-section-title">数据集配置</div>
                    
                    <div class="form-group">
                        <label class="form-label" for="createPlanDataset">关联数据集</label>
                        <select id="createPlanDataset" class="form-select">
                            <option value="">请选择数据集（可选）</option>
                            <!-- 动态加载数据集列表 -->
                        </select>
                        <span class="form-hint">选择用于评估的基准数据集，不选则需要在执行时手动配置</span>
                    </div>
                </div>
                
                <!-- 高级设置（可折叠） -->
                <div class="form-section collapsible" id="advancedSettingsSection">
                    <div class="form-section-header" onclick="toggleAdvancedSettings()">
                        <span class="form-section-title">高级设置</span>
                        <svg class="collapse-icon" id="advancedSettingsIcon" viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor" d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
                        </svg>
                    </div>
                    <div class="form-section-content" id="advancedSettingsContent" style="display:none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="createPlanGradingThreshold">批改完成阈值</label>
                                <div class="input-with-suffix">
                                    <input type="number" id="createPlanGradingThreshold" class="form-input" value="100" min="0" max="100">
                                    <span class="input-suffix">%</span>
                                </div>
                                <span class="form-hint">批改进度达到此阈值后自动进入评估阶段</span>
                            </div>
                            <div class="form-group">
                                <label class="form-label">自动执行</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="createPlanAutoExecute">
                                    <span class="toggle-slider"></span>
                                </label>
                                <span class="form-hint">开启后，批改完成自动开始评估</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeCreatePlanModal()">取消</button>
                <button class="btn btn-primary" onclick="createTestPlan()" id="createPlanSubmitBtn">创建计划</button>
            </div>
        </div>
    </div>

    <!-- 流程节点详情弹窗 -->
    <div class="modal" id="workflowNodeModal" onclick="onWorkflowNodeModalBackdropClick(event)" style="display:none;">
        <div class="modal-content workflow-node-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title" id="workflowNodeTitle">节点详情</h3>
                <button class="modal-close" onclick="closeWorkflowNodeModal()">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            
            <div class="modal-body" id="workflowNodeContent">
                <!-- 动态内容 -->
            </div>
            
            <div class="modal-footer" id="workflowNodeFooter">
                <button class="btn btn-secondary" onclick="closeWorkflowNodeModal()">关闭</button>
            </div>
        </div>
    </div>

    <!-- Toast 通知 -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- AI生成测试计划弹窗 (US-7) -->
    <div class="modal" id="aiPlanModal" onclick="onModalBackdropClick(event)" style="display:none;">
        <div class="modal-content ai-plan-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">AI 生成测试计划</h3>
                <button class="modal-close" onclick="closeAIPlanModal()">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            
            <!-- 表单区域 -->
            <div class="modal-body" id="aiPlanForm">
                <div class="form-group">
                    <label class="form-label">选择数据集 <span class="required">*</span></label>
                    <div class="dataset-checkbox-list" id="aiPlanDatasetList">
                        <div class="loading-text">加载数据集...</div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="aiPlanSampleCount">测试样本数</label>
                        <input type="number" id="aiPlanSampleCount" class="form-input" 
                               value="30" min="1" max="100" placeholder="默认30份">
                        <span class="form-hint">模拟学生作业数量（1-100）</span>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="aiPlanSubject">目标学科</label>
                        <select id="aiPlanSubject" class="form-select">
                            <option value="">自动识别</option>
                            <option value="0">英语</option>
                            <option value="1">语文</option>
                            <option value="2">数学</option>
                            <option value="3">物理</option>
                            <option value="4">化学</option>
                            <option value="5">生物</option>
                            <option value="6">地理</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- 结果区域 -->
            <div class="modal-body ai-plan-result" id="aiPlanResult" style="display:none;">
                <div class="form-group">
                    <label class="form-label" for="aiPlanName">计划名称 <span class="required">*</span></label>
                    <input type="text" id="aiPlanName" class="form-input" placeholder="输入计划名称">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="aiPlanDescription">计划描述</label>
                    <textarea id="aiPlanDescription" class="form-textarea" rows="2" placeholder="输入计划描述"></textarea>
                </div>
                
                <div class="plan-section">
                    <h4 class="plan-section-title">测试目标</h4>
                    <ul class="plan-list objectives-list" id="aiPlanObjectives"></ul>
                </div>
                
                <div class="plan-section">
                    <h4 class="plan-section-title">测试步骤</h4>
                    <ol class="plan-list steps-list" id="aiPlanSteps"></ol>
                </div>
                
                <div class="plan-row">
                    <div class="plan-section">
                        <h4 class="plan-section-title">预期时长</h4>
                        <div class="plan-duration" id="aiPlanDuration">--</div>
                    </div>
                </div>
                
                <div class="plan-section">
                    <h4 class="plan-section-title">验收标准</h4>
                    <ul class="plan-list criteria-list" id="aiPlanCriteria"></ul>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAIPlanModal()">取消</button>
                <button class="btn btn-secondary" id="backToFormBtn" onclick="backToAIPlanForm()" style="display:none;">返回修改</button>
                <button class="btn btn-primary" id="generateAIPlanBtn" onclick="generateAIPlan()" disabled>生成计划</button>
                <button class="btn btn-primary" id="saveAIPlanBtn" onclick="saveAIPlan()" style="display:none;">保存计划</button>
            </div>
        </div>
    </div>

    <!-- 热点图错误详情弹窗 (US-11.3) -->
    <div class="modal" id="heatmapDetailModal" onclick="onHeatmapDetailModalBackdropClick(event)" style="display:none;">
        <div class="modal-content heatmap-detail-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">错误详情</h3>
                <button class="modal-close" onclick="closeHeatmapDetailModal()">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="heatmap-detail-header">
                    <span class="heatmap-detail-title" id="heatmapDetailTitle">--</span>
                    <span class="heatmap-detail-badge heatmap-error-badge" id="heatmapDetailBadge">0 次错误</span>
                </div>
                
                <div class="heatmap-error-list" id="heatmapErrorList">
                    <div class="loading-text">加载中...</div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeHeatmapDetailModal()">关闭</button>
            </div>
        </div>
    </div>

    <!-- 调度配置弹窗 (US-10) -->
    <div class="modal" id="scheduleModal" onclick="onScheduleModalBackdropClick(event)" style="display:none;">

    <!-- 日报详情弹窗 (US-14) -->
    <div class="modal" id="reportDetailModal" onclick="onReportDetailModalBackdropClick(event)" style="display:none;">
        <div class="modal-content report-detail-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">日报详情</h3>
                <button class="modal-close" onclick="closeReportDetailModal()">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            
            <div class="modal-body report-detail-body">
                <div class="report-detail-header">
                    <span class="report-detail-date" id="reportDetailDate">--</span>
                    <span class="report-detail-badge" id="reportDetailBadge">--</span>
                </div>
                
                <!-- AI总结 -->
                <div class="report-summary-section">
                    <h4 class="report-section-title">AI总结</h4>
                    <div class="report-ai-summary" id="reportDetailSummary">--</div>
                </div>
                
                <!-- 统计数据 -->
                <div class="report-stats-grid">
                    <div class="report-stat-item">
                        <span class="report-stat-value" id="reportDetailCompleted">0</span>
                        <span class="report-stat-label">完成任务</span>
                    </div>
                    <div class="report-stat-item">
                        <span class="report-stat-value" id="reportDetailPlanned">0</span>
                        <span class="report-stat-label">计划任务</span>
                    </div>
                    <div class="report-stat-item">
                        <span class="report-stat-value" id="reportDetailAccuracy">--</span>
                        <span class="report-stat-label">准确率</span>
                    </div>
                    <div class="report-stat-item">
                        <span class="report-stat-value" id="reportDetailChange">--</span>
                        <span class="report-stat-label">较昨日</span>
                    </div>
                </div>
                
                <!-- 主要错误类型 -->
                <div class="report-errors-section">
                    <h4 class="report-section-title">主要错误类型 Top 5</h4>
                    <div class="report-errors-list" id="reportDetailErrors">--</div>
                </div>
                
                <!-- 新增错误类型 -->
                <div class="report-new-errors-section" id="reportNewErrorsSection" style="display:none;">
                    <h4 class="report-section-title">新增错误类型</h4>
                    <div class="report-new-errors-list" id="reportDetailNewErrors"></div>
                </div>
                
                <!-- 高频错误题目 -->
                <div class="report-high-freq-section" id="reportHighFreqSection" style="display:none;">
                    <h4 class="report-section-title">高频错误题目</h4>
                    <div class="report-high-freq-list" id="reportDetailHighFreq"></div>
                </div>
                
                <!-- 异常情况 -->
                <div class="report-anomalies-section" id="reportAnomaliesSection" style="display:none;">
                    <h4 class="report-section-title">异常情况</h4>
                    <div class="report-anomalies-list" id="reportDetailAnomalies"></div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeReportDetailModal()">关闭</button>
                <button class="btn btn-primary" onclick="exportDailyReport()">
                    <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
                    <span>导出 Word</span>
                </button>
            </div>
        </div>
    </div>

    <!-- 调度配置弹窗 (US-10) -->
        <div class="modal-content schedule-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">调度配置</h3>
                <button class="modal-close" onclick="closeScheduleModal()">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            
            <div class="modal-body">
                <input type="hidden" id="schedulePlanId">
                
                <!-- 调度开关 -->
                <div class="form-group schedule-toggle-group">
                    <label class="form-label">启用自动调度</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="scheduleEnabled" onchange="onScheduleEnabledChange()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                
                <!-- 调度配置表单 -->
                <div class="schedule-config" id="scheduleConfig">
                    <div class="form-group">
                        <label class="form-label" for="scheduleType">调度类型</label>
                        <select id="scheduleType" class="form-select" onchange="onScheduleTypeChange()">
                            <option value="daily">每天执行</option>
                            <option value="weekly">每周执行</option>
                            <option value="cron">自定义 Cron</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="scheduleTime">执行时间</label>
                        <input type="time" id="scheduleTime" class="form-input" value="09:00">
                    </div>
                    
                    <div class="form-group" id="weeklyDayGroup" style="display:none;">
                        <label class="form-label" for="scheduleDayOfWeek">执行日期</label>
                        <select id="scheduleDayOfWeek" class="form-select">
                            <option value="0">周一</option>
                            <option value="1">周二</option>
                            <option value="2">周三</option>
                            <option value="3">周四</option>
                            <option value="4">周五</option>
                            <option value="5">周六</option>
                            <option value="6">周日</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="cronGroup" style="display:none;">
                        <label class="form-label" for="scheduleCron">Cron 表达式</label>
                        <input type="text" id="scheduleCron" class="form-input" placeholder="0 9 * * *">
                        <span class="form-hint">格式: 分 时 日 月 周 (如: 0 9 * * * 表示每天9点)</span>
                    </div>
                </div>
                
                <!-- 下次执行时间 -->
                <div class="schedule-next-run" id="scheduleNextRunSection">
                    <div class="next-run-label">下次执行时间</div>
                    <div class="next-run-time" id="scheduleNextRun">--</div>
                </div>
                
                <!-- 执行日志 -->
                <div class="schedule-logs-section">
                    <div class="section-header-small">
                        <h4 class="section-title-small">执行日志</h4>
                        <button class="btn btn-text" onclick="refreshScheduleLogs()">刷新</button>
                    </div>
                    <div class="schedule-logs" id="scheduleLogs">
                        <div class="empty-text">暂无执行记录</div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeScheduleModal()">取消</button>
                <button class="btn btn-warning" id="executeNowBtn" onclick="executeScheduleNow()">立即执行</button>
                <button class="btn btn-primary" id="saveScheduleBtn" onclick="saveScheduleConfig()">保存配置</button>
            </div>
        </div>
    </div>

    <!-- 错误样本库弹窗 -->
    <div class="modal" id="errorSamplesModal" onclick="onErrorSamplesModalBackdropClick(event)" style="display:none;">
        <div class="modal-content modal-lg" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">错误样本库</h3>
                <button class="modal-close" onclick="closeErrorSamplesModal()">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <!-- 统计卡片 -->
                <div class="stats-row">
                    <div class="stat-card-mini"><span class="stat-value" id="errorSampleTotal">0</span><span class="stat-label">总样本</span></div>
                    <div class="stat-card-mini"><span class="stat-value" id="errorSamplePending">0</span><span class="stat-label">待分析</span></div>
                    <div class="stat-card-mini"><span class="stat-value" id="errorSampleAnalyzed">0</span><span class="stat-label">已分析</span></div>
                    <div class="stat-card-mini"><span class="stat-value" id="errorSampleFixed">0</span><span class="stat-label">已修复</span></div>
                </div>
                <!-- 筛选器 -->
                <div class="filter-row">
                    <select id="errorTypeFilter" class="form-select-sm" onchange="filterErrorSamples()">
                        <option value="">全部类型</option>
                        <option value="漏批">漏批</option>
                        <option value="误批">误批</option>
                        <option value="评分偏差">评分偏差</option>
                    </select>
                    <select id="errorStatusFilter" class="form-select-sm" onchange="filterErrorSamples()">
                        <option value="">全部状态</option>
                        <option value="pending">待分析</option>
                        <option value="analyzed">已分析</option>
                        <option value="fixed">已修复</option>
                    </select>
                </div>
                <!-- 样本列表 -->
                <div class="sample-list" id="errorSampleList">
                    <div class="empty-state">暂无错误样本数据</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeErrorSamplesModal()">关闭</button>
            </div>
        </div>
    </div>

    <!-- 异常检测弹窗 -->
    <div class="modal" id="anomalyModal" onclick="onAnomalyModalBackdropClick(event)" style="display:none;">
        <div class="modal-content modal-md" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">异常检测</h3>
                <button class="modal-close" onclick="closeAnomalyModal()">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="stats-row">
                    <div class="stat-card-mini"><span class="stat-value" id="anomalyTotal">0</span><span class="stat-label">总异常</span></div>
                    <div class="stat-card-mini warning"><span class="stat-value" id="anomalyUnconfirmed">0</span><span class="stat-label">未确认</span></div>
                    <div class="stat-card-mini"><span class="stat-value" id="anomalyToday">0</span><span class="stat-label">今日新增</span></div>
                </div>
                <div class="anomaly-list" id="anomalyList">
                    <div class="empty-state">暂无异常记录</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAnomalyModal()">关闭</button>
            </div>
        </div>
    </div>

    <!-- 错误聚类弹窗 -->
    <div class="modal" id="clusteringModal" onclick="onClusteringModalBackdropClick(event)" style="display:none;">
        <div class="modal-content modal-md" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">错误聚类分析</h3>
                <button class="modal-close" onclick="closeClusteringModal()">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="cluster-list" id="clusterList">
                    <div class="empty-state">暂无聚类数据，请先进行批量评估</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeClusteringModal()">关闭</button>
            </div>
        </div>
    </div>

    <!-- 优化建议弹窗 -->
    <div class="modal" id="optimizationModal" onclick="onOptimizationModalBackdropClick(event)" style="display:none;">
        <div class="modal-content modal-md" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">优化建议</h3>
                <button class="modal-close" onclick="closeOptimizationModal()">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="suggestion-list" id="suggestionList">
                    <div class="empty-state">暂无优化建议</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeOptimizationModal()">关闭</button>
            </div>
        </div>
    </div>

    <!-- 批次对比弹窗 -->
    <div class="modal" id="batchCompareModal" onclick="onBatchCompareModalBackdropClick(event)" style="display:none;">
        <div class="modal-content modal-lg" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">批次对比</h3>
                <button class="modal-close" onclick="closeBatchCompareModal()">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <!-- 批次选择器 -->
                <div class="compare-selector">
                    <div class="compare-select-group">
                        <label class="form-label">批次 A</label>
                        <select id="compareTaskA" class="form-select" onchange="onCompareTaskChange()">
                            <option value="">选择批量评估任务</option>
                        </select>
                    </div>
                    <div class="compare-vs">VS</div>
                    <div class="compare-select-group">
                        <label class="form-label">批次 B</label>
                        <select id="compareTaskB" class="form-select" onchange="onCompareTaskChange()">
                            <option value="">选择批量评估任务</option>
                        </select>
                    </div>
                </div>
                <!-- 对比结果 -->
                <div class="compare-result" id="compareResult" style="display:none;">
                    <div class="compare-summary">
                        <div class="compare-card">
                            <div class="compare-card-title">批次 A</div>
                            <div class="compare-card-value" id="compareAccA">--</div>
                            <div class="compare-card-label">准确率</div>
                        </div>
                        <div class="compare-diff">
                            <span class="diff-arrow" id="compareDiffArrow">-</span>
                            <span class="diff-value" id="compareDiffValue">--</span>
                        </div>
                        <div class="compare-card">
                            <div class="compare-card-title">批次 B</div>
                            <div class="compare-card-value" id="compareAccB">--</div>
                            <div class="compare-card-label">准确率</div>
                        </div>
                    </div>
                    <div class="compare-details" id="compareDetails"></div>
                </div>
                <div class="empty-state" id="compareEmpty">请选择两个批量评估任务进行对比</div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeBatchCompareModal()">关闭</button>
            </div>
        </div>
    </div>

    <!-- 数据下钻弹窗 -->
    <div class="modal" id="drilldownModal" onclick="onDrilldownModalBackdropClick(event)" style="display:none;">
        <div class="modal-content modal-lg" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">数据下钻分析</h3>
                <button class="modal-close" onclick="closeDrilldownModal()">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <!-- 维度选择器 -->
                <div class="drilldown-nav">
                    <button class="drilldown-nav-btn active" data-dimension="subject" onclick="switchDrilldownDimension('subject')">按学科</button>
                    <button class="drilldown-nav-btn" data-dimension="book" onclick="switchDrilldownDimension('book')">按书本</button>
                    <button class="drilldown-nav-btn" data-dimension="question_type" onclick="switchDrilldownDimension('question_type')">按错误类型</button>
                </div>
                <!-- 面包屑 -->
                <div class="drilldown-breadcrumb" id="drilldownBreadcrumb">
                    <span class="breadcrumb-item active">全部</span>
                </div>
                <!-- 数据列表 -->
                <div class="drilldown-list" id="drilldownList">
                    <div class="empty-state">加载中...</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeDrilldownModal()">关闭</button>
            </div>
        </div>
    </div>

    <!-- AI 分析报告弹窗 -->
    <div class="modal" id="analysisReportModal" onclick="onAnalysisReportModalBackdropClick(event)" style="display:none;">
        <div class="modal-content modal-lg" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">AI 智能分析报告</h3>
                <button class="modal-close" onclick="closeAnalysisReportModal()">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <!-- 报告状态 -->
                <div id="analysisReportStatus" class="analysis-status">
                    <div class="loading-spinner"></div>
                    <span>加载中...</span>
                </div>
                
                <!-- 报告内容 -->
                <div id="analysisReportContent" style="display:none;">
                    <!-- 概览 -->
                    <div class="analysis-section">
                        <h4 class="analysis-section-title">概览</h4>
                        <div class="analysis-summary" id="analysisSummary">
                            <div class="summary-stats">
                                <div class="stat-card">
                                    <div class="stat-value" id="summaryTotalErrors">--</div>
                                    <div class="stat-label">错误总数</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="summaryErrorRate">--</div>
                                    <div class="stat-label">错误率</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="summaryFocusCount">--</div>
                                    <div class="stat-label">重点关注</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 层级分析 -->
                    <div class="analysis-section">
                        <h4 class="analysis-section-title">层级分析</h4>
                        <div class="analysis-drilldown">
                            <div class="drilldown-tabs">
                                <button class="drilldown-tab active" data-level="subject" onclick="switchAnalysisLevel('subject')">按学科</button>
                                <button class="drilldown-tab" data-level="book" onclick="switchAnalysisLevel('book')">按书本</button>
                                <button class="drilldown-tab" data-level="page" onclick="switchAnalysisLevel('page')">按页码</button>
                            </div>
                            <div class="drilldown-content" id="analysisDrilldownContent">
                                <!-- 动态内容 -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- 错误模式 -->
                    <div class="analysis-section">
                        <h4 class="analysis-section-title">错误模式</h4>
                        <div class="error-patterns" id="analysisErrorPatterns">
                            <!-- 动态内容 -->
                        </div>
                    </div>
                    
                    <!-- 根因分析 -->
                    <div class="analysis-section">
                        <h4 class="analysis-section-title">根因分析</h4>
                        <div class="root-causes" id="analysisRootCauses">
                            <!-- 动态内容 -->
                        </div>
                    </div>
                    
                    <!-- 优化建议 -->
                    <div class="analysis-section">
                        <h4 class="analysis-section-title">优化建议</h4>
                        <div class="suggestions" id="analysisSuggestions">
                            <!-- 动态内容 -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAnalysisReportModal()">关闭</button>
                <button class="btn btn-primary" onclick="triggerAnalysis()" id="triggerAnalysisBtn">重新分析</button>
            </div>
        </div>
    </div>

    <!-- 自动化管理弹窗 -->
    <div class="modal" id="automationModal" onclick="onAutomationModalBackdropClick(event)" style="display:none;">
        <div class="modal-content modal-md" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">自动化任务管理</h3>
                <button class="modal-close" onclick="closeAutomationModal()">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <!-- 全局控制 -->
                <div class="automation-controls">
                    <div class="control-row">
                        <span class="control-label">全局状态</span>
                        <div class="control-actions">
                            <button class="btn btn-sm btn-secondary" onclick="pauseAllAutomation()" id="pauseAllBtn">暂停全部</button>
                            <button class="btn btn-sm btn-primary" onclick="resumeAllAutomation()" id="resumeAllBtn">恢复全部</button>
                        </div>
                    </div>
                </div>
                
                <!-- 队列状态 -->
                <div class="automation-section">
                    <h4 class="section-title">队列状态</h4>
                    <div class="queue-status" id="automationQueueStatus">
                        <div class="queue-stats">
                            <span class="queue-stat">等待: <strong id="queueWaiting">0</strong></span>
                            <span class="queue-stat">执行中: <strong id="queueRunning">0</strong></span>
                        </div>
                        <button class="btn btn-sm btn-warning" onclick="clearAutomationQueue()">清空队列</button>
                    </div>
                </div>
                
                <!-- 任务列表 -->
                <div class="automation-section">
                    <h4 class="section-title">任务配置</h4>
                    <div class="automation-tasks" id="automationTaskList">
                        <!-- 动态内容 -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAutomationModal()">关闭</button>
            </div>
        </div>
    </div>

    <!-- 添加优化日志弹窗 -->
    <div class="modal" id="addOptLogModal" onclick="onAddOptLogModalBackdropClick(event)" style="display:none;">
        <div class="modal-content modal-sm" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">添加优化日志</h3>
                <button class="modal-close" onclick="closeAddOptLogModal()">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>分类</label>
                    <select id="optLogCategory" class="form-select">
                        <option value="general">通用</option>
                        <option value="accuracy">准确率</option>
                        <option value="performance">性能</option>
                        <option value="feature">功能</option>
                        <option value="bugfix">修复</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>内容</label>
                    <textarea id="optLogContent" rows="4" placeholder="输入优化内容，每行一条..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAddOptLogModal()">取消</button>
                <button class="btn btn-primary" onclick="saveOptLog()">保存</button>
            </div>
        </div>
    </div>

    <!-- 全局设置弹窗 -->
    <div class="modal" id="globalSettingsModal" onclick="onGlobalSettingsModalBackdropClick(event)" style="display:none;">
        <div class="modal-content modal-md" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">全局设置</h3>
                <button class="modal-close" onclick="closeGlobalSettingsModal()">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <!-- 模型设置 -->
                <div class="settings-section">
                    <h4 class="settings-section-title">默认模型</h4>
                    <div class="settings-row">
                        <label class="settings-label">视觉模型</label>
                        <select class="settings-select" id="settingsVisionModel">
                            <option value="doubao-seed-1-8-251228">Seed 1.8</option>
                            <option value="doubao-seed-1-6-vision-250815">Seed 1.6 Vision</option>
                            <option value="doubao-1-5-vision-pro-32k-250115">Vision Pro 1.5</option>
                        </select>
                    </div>
                    <div class="settings-row">
                        <label class="settings-label">文本模型</label>
                        <select class="settings-select" id="settingsTextModel">
                            <option value="deepseek-v3.2">DeepSeek V3.2</option>
                            <option value="deepseek-chat">DeepSeek Chat</option>
                            <option value="qwen3-max">Qwen3 Max</option>
                        </select>
                    </div>
                </div>
                
                <!-- 通知设置 -->
                <div class="settings-section">
                    <h4 class="settings-section-title">通知</h4>
                    <div class="settings-row">
                        <label class="settings-label">任务完成通知</label>
                        <div class="settings-toggle active" id="settingsNotifyComplete" onclick="toggleGlobalSetting('notifyComplete')"></div>
                    </div>
                    <div class="settings-row">
                        <label class="settings-label">错误提醒</label>
                        <div class="settings-toggle active" id="settingsNotifyError" onclick="toggleGlobalSetting('notifyError')"></div>
                    </div>
                </div>
                
                <!-- 显示设置 -->
                <div class="settings-section">
                    <h4 class="settings-section-title">显示</h4>
                    <div class="settings-row">
                        <label class="settings-label">自动刷新间隔</label>
                        <select class="settings-select" id="settingsRefreshInterval">
                            <option value="30">30秒</option>
                            <option value="60">1分钟</option>
                            <option value="300">5分钟</option>
                            <option value="0">关闭</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeGlobalSettingsModal()">取消</button>
                <button class="btn btn-primary" onclick="saveGlobalSettings()">保存</button>
            </div>
        </div>
    </div>

    <script type="module" src="/static/js/index.js?v=20260125_v2"></script>
</body>
</html>
